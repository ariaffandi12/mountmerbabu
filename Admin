-- Mount Merbabu GUI Script - STEALTH UNDETECTABLE EDITION
-- Features: Complete Stealth + Advanced Anti-Detection + Undetectable Bypass
-- Version: 1.3 - Ultimate Stealth Edition - UNDETECTABLE

-- Advanced Stealth Initialization
local function initStealth()
    -- Hide from task manager and script detection
    pcall(function()
        local hidden = {}
        local mt = getrawmetatable(game)
        local oldNamecall = mt.__namecall
        local oldIndex = mt.__index
        local oldNewIndex = mt.__newindex
        
        setreadonly(mt, false)
        
        -- Advanced metamethod protection with stealth
        mt.__namecall = newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}
            
            -- Block all detection methods
            if method == "Kick" or method == "kick" or method == "Ban" or method == "ban" then
                return wait(9e9)
            end
            
            -- Block anticheat communications
            if method == "FireServer" or method == "InvokeServer" then
                local name = tostring(self):lower()
                if name:find("anticheat") or name:find("ban") or name:find("kick") or 
                   name:find("detect") or name:find("security") or name:find("admin") or
                   name:find("report") or name:find("log") or name:find("monitor") then
                    return wait(9e9)
                end
            end
            
            -- Hide our script from detection
            if method == "GetChildren" or method == "GetDescendants" then
                local result = oldNamecall(self, ...)
                local filtered = {}
                for i, v in pairs(result) do
                    if not tostring(v):find("MountMerbabu") then
                        table.insert(filtered, v)
                    end
                end
                return filtered
            end
            
            return oldNamecall(self, ...)
        end)
        
        -- Advanced index protection
        mt.__index = newcclosure(function(self, key)
            -- Hide our modifications
            if key == "WalkSpeed" and speedHackEnabled then
                return 16 -- Return normal value to fool detection
            elseif key == "JumpPower" and jumpBoostEnabled then
                return 50 -- Return normal value
            elseif key == "Health" and godModeEnabled then
                return oldIndex(self, key) -- Return actual health to avoid detection
            end
            
            return oldIndex(self, key)
        end)
        
        -- Advanced newindex protection with spoofing
        mt.__newindex = newcclosure(function(self, key, value)
            -- Allow our modifications but hide them
            if key == "WalkSpeed" or key == "JumpPower" or key == "Health" or 
               key == "CFrame" or key == "Position" or key == "Transparency" then
                return oldNewIndex(self, key, value)
            end
            
            return oldNewIndex(self, key, value)
        end)
        
        setreadonly(mt, true)
    end)
end

-- Advanced Script Protection
local function protectScript()
    pcall(function()
        -- Remove all anticheat scripts
        for _, script in pairs(game:GetDescendants()) do
            if script:IsA("LocalScript") or script:IsA("Script") then
                local name = script.Name:lower()
                local source = ""
                pcall(function() source = script.Source:lower() end)
                
                if name:find("anticheat") or name:find("anticheats") or name:find("antihack") or
                   name:find("security") or name:find("detect") or name:find("ban") or
                   source:find("kick") or source:find("ban") or source:find("anticheat") then
                    script.Disabled = true
                    script:Destroy()
                end
            end
        end
        
        -- Remove anticheat RemoteEvents
        for _, remote in pairs(game:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                local name = remote.Name:lower()
                if name:find("anticheat") or name:find("ban") or name:find("kick") or
                   name:find("detect") or name:find("security") or name:find("report") or
                   name:find("log") or name:find("admin") or name:find("monitor") then
                    remote:Destroy()
                end
            end
        end
    end)
end

-- Initialize stealth systems
initStealth()
protectScript()

-- Services with stealth loading
local Services = {}
pcall(function()
    Services.Players = game:GetService("Players")
    Services.ReplicatedStorage = game:GetService("ReplicatedStorage")
    Services.TweenService = game:GetService("TweenService")
    Services.UserInputService = game:GetService("UserInputService")
    Services.RunService = game:GetService("RunService")
    Services.Workspace = game:GetService("Workspace")
    Services.Lighting = game:GetService("Lighting")
    Services.SoundService = game:GetService("SoundService")
    Services.HttpService = game:GetService("HttpService")
    Services.TeleportService = game:GetService("TeleportService")
    Services.StarterGui = game:GetService("StarterGui")
end)

local LocalPlayer = Services.Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Stealth Variables
local StealthMode = {
    Active = true,
    AntiDetection = true,
    SpoofValues = true,
    HideModifications = true,
    SilentExecution = true
}

-- Feature Variables with stealth tracking
local Features = {
    autoClimb = false,
    flyMode = false,
    speedHack = false,
    autoCollect = false,
    esp = false,
    infiniteStamina = false,
    weatherControl = false,
    autoQuest = false,
    adminMode = false,
    godMode = false,
    noclip = false,
    invisible = false,
    jumpBoost = false
}

-- Original values for spoofing
local OriginalValues = {
    WalkSpeed = 16,
    JumpPower = 50,
    Health = 100,
    MaxHealth = 100
}

-- Connections with stealth management
local Connections = {}

-- Advanced Stealth GUI Creation
local function createStealthGUI()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "MountMerbabuGUI_Stealth"
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    
    -- Hide from detection
    pcall(function()
        ScreenGui.AncestryChanged:Connect(function()
            if not ScreenGui.Parent then
                ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
            end
        end)
    end)
    
    return ScreenGui
end

local ScreenGui = createStealthGUI()

-- Main Frame with advanced stealth design
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 15, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.25, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0, 500, 0, 750)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = true

-- Stealth gradient
local MainGradient = Instance.new("UIGradient")
MainGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(15, 20, 30)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(5, 10, 15))
}
MainGradient.Rotation = 45
MainGradient.Parent = MainFrame

-- Stealth shadow
local MainShadow = Instance.new("Frame")
MainShadow.Name = "Shadow"
MainShadow.Parent = ScreenGui
MainShadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainShadow.BackgroundTransparency = 0.8
MainShadow.BorderSizePixel = 0
MainShadow.Position = UDim2.new(0.25, 3, 0.1, 3)
MainShadow.Size = UDim2.new(0, 500, 0, 750)
MainShadow.ZIndex = -1

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 18)
MainCorner.Parent = MainFrame

local ShadowCorner = Instance.new("UICorner")
ShadowCorner.CornerRadius = UDim.new(0, 18)
ShadowCorner.Parent = MainShadow

-- Advanced Dragging with stealth
local function makeDraggable(frame)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            if MainShadow then
                MainShadow.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X + 3, startPos.Y.Scale, startPos.Y.Offset + delta.Y + 3)
            end
        end
    end)
    
    frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

makeDraggable(MainFrame)

-- Stealth Top Bar
local TopBar = Instance.new("Frame")
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(20, 25, 35)
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 90)

local TopBarGradient = Instance.new("UIGradient")
TopBarGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 30, 40)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 20, 30))
}
TopBarGradient.Rotation = 90
TopBarGradient.Parent = TopBar

local TopCorner = Instance.new("UICorner")
TopCorner.CornerRadius = UDim.new(0, 18)
TopCorner.Parent = TopBar

-- Stealth Title
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = TopBar
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 20, 0, 5)
TitleLabel.Size = UDim2.new(1, -150, 0, 25)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "🏔️ MOUNT MERBABU GUI"
TitleLabel.TextColor3 = Color3.fromRGB(200, 220, 255)
TitleLabel.TextSize = 18
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

local SubTitle = Instance.new("TextLabel")
SubTitle.Name = "SubTitle"
SubTitle.Parent = TopBar
SubTitle.BackgroundTransparency = 1
SubTitle.Position = UDim2.new(0, 20, 0, 30)
SubTitle.Size = UDim2.new(1, -150, 0, 20)
SubTitle.Font = Enum.Font.Gotham
SubTitle.Text = "v1.3 • Stealth Edition • UNDETECTABLE"
SubTitle.TextColor3 = Color3.fromRGB(120, 140, 180)
SubTitle.TextSize = 12
SubTitle.TextXAlignment = Enum.TextXAlignment.Left

-- Stealth Status Indicators
local StealthIndicator = Instance.new("TextLabel")
StealthIndicator.Name = "StealthIndicator"
StealthIndicator.Parent = TopBar
StealthIndicator.BackgroundTransparency = 1
StealthIndicator.Position = UDim2.new(0, 20, 0, 50)
StealthIndicator.Size = UDim2.new(1, -150, 0, 15)
StealthIndicator.Font = Enum.Font.GothamBold
StealthIndicator.Text = "🥷 STEALTH MODE • 👤 USER MODE"
StealthIndicator.TextColor3 = Color3.fromRGB(0, 255, 100)
StealthIndicator.TextSize = 11
StealthIndicator.TextXAlignment = Enum.TextXAlignment.Left

local ProtectionStatus = Instance.new("TextLabel")
ProtectionStatus.Name = "ProtectionStatus"
ProtectionStatus.Parent = TopBar
ProtectionStatus.BackgroundTransparency = 1
ProtectionStatus.Position = UDim2.new(0, 20, 0, 65)
ProtectionStatus.Size = UDim2.new(1, -150, 0, 15)
ProtectionStatus.Font = Enum.Font.Gotham
ProtectionStatus.Text = "🛡️ UNDETECTABLE • 🔒 STEALTH ACTIVE • 👻 INVISIBLE"
ProtectionStatus.TextColor3 = Color3.fromRGB(0, 255, 0)
ProtectionStatus.TextSize = 10
ProtectionStatus.TextXAlignment = Enum.TextXAlignment.Left

-- Admin Toggle Button with stealth design
local AdminToggleButton = Instance.new("TextButton")
AdminToggleButton.Name = "AdminToggleButton"
AdminToggleButton.Parent = TopBar
AdminToggleButton.BackgroundColor3 = Color3.fromRGB(50, 20, 80)
AdminToggleButton.BorderSizePixel = 0
AdminToggleButton.Position = UDim2.new(1, -120, 0, 15)
AdminToggleButton.Size = UDim2.new(0, 35, 0, 35)
AdminToggleButton.Font = Enum.Font.GothamBold
AdminToggleButton.Text = "👑"
AdminToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AdminToggleButton.TextSize = 16

local AdminToggleCorner = Instance.new("UICorner")
AdminToggleCorner.CornerRadius = UDim.new(0, 10)
AdminToggleCorner.Parent = AdminToggleButton

-- Control Buttons
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Parent = TopBar
MinimizeButton.BackgroundColor3 = Color3.fromRGB(100, 80, 0)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Position = UDim2.new(1, -80, 0, 15)
MinimizeButton.Size = UDim2.new(0, 35, 0, 35)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Text = "−"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 20

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 10)
MinCorner.Parent = MinimizeButton

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Parent = TopBar
CloseButton.BackgroundColor3 = Color3.fromRGB(100, 20, 20)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -40, 0, 15)
CloseButton.Size = UDim2.new(0, 35, 0, 35)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "✕"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 10)
CloseCorner.Parent = CloseButton

-- Stealth Content Frame
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.BorderSizePixel = 0
ContentFrame.Position = UDim2.new(0, 0, 0, 90)
ContentFrame.Size = UDim2.new(1, 0, 1, -90)
ContentFrame.ScrollBarThickness = 10
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 100, 120)
ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 2200)
ContentFrame.ScrollingDirection = Enum.ScrollingDirection.Y

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Parent = ContentFrame
ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
ContentLayout.Padding = UDim.new(0, 18)
ContentLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- Stealth Section Creation
local function createStealthSection(name, title, layoutOrder, height, adminOnly)
    local section = Instance.new("Frame")
    section.Name = name
    section.Parent = ContentFrame
    section.BackgroundColor3 = adminOnly and Color3.fromRGB(40, 15, 15) or Color3.fromRGB(15, 25, 40)
    section.BorderSizePixel = 0
    section.Size = UDim2.new(1, -40, 0, height or 140)
    section.LayoutOrder = layoutOrder
    section.Visible = adminOnly and false or true
    
    local sectionGradient = Instance.new("UIGradient")
    if adminOnly then
        sectionGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 20, 20)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 10, 10))
        }
    else
        sectionGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 30, 50)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 20, 35))
        }
    end
    sectionGradient.Rotation = 45
    sectionGradient.Parent = section
    
    local sectionCorner = Instance.new("UICorner")
    sectionCorner.CornerRadius = UDim.new(0, 15)
    sectionCorner.Parent = section
    
    -- Stealth border effect
    local sectionStroke = Instance.new("UIStroke")
    sectionStroke.Color = adminOnly and Color3.fromRGB(100, 50, 50) or Color3.fromRGB(50, 80, 120)
    sectionStroke.Thickness = 1
    sectionStroke.Transparency = 0.7
    sectionStroke.Parent = section
    
    local sectionTitle = Instance.new("TextLabel")
    sectionTitle.Name = "Title"
    sectionTitle.Parent = section
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.Position = UDim2.new(0, 25, 0, 12)
    sectionTitle.Size = UDim2.new(1, -50, 0, 30)
    sectionTitle.Font = Enum.Font.GothamBold
    sectionTitle.Text = title
    sectionTitle.TextColor3 = adminOnly and Color3.fromRGB(255, 150, 150) or Color3.fromRGB(200, 220, 255)
    sectionTitle.TextSize = 16
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    local sectionGrid = Instance.new("Frame")
    sectionGrid.Name = "Grid"
    sectionGrid.Parent = section
    sectionGrid.BackgroundTransparency = 1
    sectionGrid.Position = UDim2.new(0, 20, 0, 50)
    sectionGrid.Size = UDim2.new(1, -40, 1, -60)
    
    local gridLayout = Instance.new("UIGridLayout")
    gridLayout.Parent = sectionGrid
    gridLayout.CellSize = UDim2.new(0, 220, 0, 40)
    gridLayout.CellPadding = UDim2.new(0, 12, 0, 10)
    gridLayout.SortOrder = Enum.SortOrder.LayoutOrder
    
    return section, sectionGrid
end

-- Stealth Button Creation
local function createStealthButton(name, parent, text, color, layoutOrder, adminOnly)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Parent = parent
    button.BackgroundColor3 = color
    button.BorderSizePixel = 0
    button.Font = Enum.Font.GothamSemibold
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.TextWrapped = true
    button.LayoutOrder = layoutOrder
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 10)
    buttonCorner.Parent = button
    
    local buttonGradient = Instance.new("UIGradient")
    buttonGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.new(math.min(color.R * 1.3, 1), math.min(color.G * 1.3, 1), math.min(color.B * 1.3, 1))),
        ColorSequenceKeypoint.new(1, color)
    }
    buttonGradient.Rotation = 90
    buttonGradient.Parent = button
    
    -- Stealth glow effect for admin buttons
    if adminOnly then
        local buttonStroke = Instance.new("UIStroke")
        buttonStroke.Color = Color3.fromRGB(255, 100, 100)
        buttonStroke.Thickness = 1
        buttonStroke.Transparency = 0.6
        buttonStroke.Parent = button
        
        -- Animated glow
        spawn(function()
            while button.Parent do
                Services.TweenService:Create(buttonStroke, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
                    Transparency = 0.3
                }):Play()
                wait(1)
            end
        end)
    end
    
    -- Enhanced hover effects
    button.MouseEnter:Connect(function()
        local tween = Services.TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.new(math.min(color.R * 1.4, 1), math.min(color.G * 1.4, 1), math.min(color.B * 1.4, 1)),
            Size = UDim2.new(0, 225, 0, 42)
        })
        tween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local tween = Services.TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundColor3 = color,
            Size = UDim2.new(0, 220, 0, 40)
        })
        tween:Play()
    end)
    
    return button
end

-- Create All Sections
local movementSection, movementGrid = createStealthSection("MovementSection", "🚶 MOVEMENT & CLIMBING", 1, 160, false)
local teleportSection, teleportGrid = createStealthSection("TeleportSection", "📍 TELEPORT LOCATIONS", 2, 160, false)
local utilitySection, utilityGrid = createStealthSection("UtilitySection", "🛠️ UTILITY FEATURES", 3, 160, false)
local visualSection, visualGrid = createStealthSection("VisualSection", "👁️ VISUAL ENHANCEMENTS", 4, 120, false)

-- ADMIN SECTIONS
local adminControlSection, adminControlGrid = createStealthSection("AdminControlSection", "👑 ADMIN CONTROLS", 5, 160, true)
local playerManagementSection, playerManagementGrid = createStealthSection("PlayerManagementSection", "👥 PLAYER MANAGEMENT", 6, 200, true)
local serverControlSection, serverControlGrid = createStealthSection("ServerControlSection", "🖥️ SERVER CONTROLS", 7, 160, true)
local advancedSection, advancedGrid = createStealthSection("AdvancedSection", "⚡ ADVANCED FEATURES", 8, 160, true)
local stealthSection, stealthGrid = createStealthSection("StealthSection", "🥷 STEALTH & BYPASS", 9, 160, true)

local statusSection, statusGrid = createStealthSection("StatusSection", "📊 STATUS & MONITORING", 10, 140, false)

-- Create Movement Buttons
local autoClimbBtn = createStealthButton("AutoClimb", movementGrid, "🧗 Auto Climb: OFF", Color3.fromRGB(40, 120, 40), 1, false)
local flyModeBtn = createStealthButton("FlyMode", movementGrid, "✈️ Fly Mode: OFF", Color3.fromRGB(40, 100, 200), 2, false)
local speedHackBtn = createStealthButton("SpeedHack", movementGrid, "⚡ Speed Hack: OFF", Color3.fromRGB(200, 120, 40), 3, false)
local infiniteStaminaBtn = createStealthButton("InfiniteStamina", movementGrid, "💪 Infinite Stamina: OFF", Color3.fromRGB(180, 40, 80), 4, false)
local jumpBoostBtn = createStealthButton("JumpBoost", movementGrid, "🦘 Jump Boost: OFF", Color3.fromRGB(120, 60, 180), 5, false)
local noclipBtn = createStealthButton("Noclip", movementGrid, "👻 Noclip: OFF", Color3.fromRGB(100, 60, 200), 6, false)

-- Create Teleport Buttons
local baseCampBtn = createStealthButton("BaseCamp", teleportGrid, "🏕️ Base Camp", Color3.fromRGB(60, 100, 60), 1, false)
local checkpoint1Btn = createStealthButton("Checkpoint1", teleportGrid, "📍 Checkpoint 1", Color3.fromRGB(50, 120, 200), 2, false)
local checkpoint2Btn = createStealthButton("Checkpoint2", teleportGrid, "📍 Checkpoint 2", Color3.fromRGB(50, 120, 200), 3, false)
local summitBtn = createStealthButton("Summit", teleportGrid, "🏔️ Summit", Color3.fromRGB(200, 150, 50), 4, false)
local safeZoneBtn = createStealthButton("SafeZone", teleportGrid, "🛡️ Safe Zone", Color3.fromRGB(80, 140, 80), 5, false)
local playerTpBtn = createStealthButton("PlayerTp", teleportGrid, "👤 Player TP", Color3.fromRGB(150, 80, 150), 6, false)

-- Create Utility Buttons
local autoCollectBtn = createStealthButton("AutoCollect", utilityGrid, "🎒 Auto Collect: OFF", Color3.fromRGB(120, 60, 140), 1, false)
local autoQuestBtn = createStealthButton("AutoQuest", utilityGrid, "📋 Auto Quest: OFF", Color3.fromRGB(200, 100, 50), 2, false)
local weatherControlBtn = createStealthButton("WeatherControl", utilityGrid, "🌤️ Weather Control", Color3.fromRGB(50, 140, 200), 3, false)
local equipmentBtn = createStealthButton("Equipment", utilityGrid, "🎒 Get Equipment", Color3.fromRGB(100, 80, 70), 4, false)
local healBtn = createStealthButton("Heal", utilityGrid, "❤️ Full Heal", Color3.fromRGB(200, 80, 80), 5, false)
local infiniteJumpBtn = createStealthButton("InfiniteJump", utilityGrid, "🔄 Infinite Jump", Color3.fromRGB(80, 180, 120), 6, false)

-- Create Visual Buttons
local espBtn = createStealthButton("ESP", visualGrid, "👁️ ESP: OFF", Color3.fromRGB(180, 50, 120), 1, false)
local fullbrightBtn = createStealthButton("Fullbright", visualGrid, "💡 Fullbright: OFF", Color3.fromRGB(200, 180, 80), 2, false)
local xrayBtn = createStealthButton("Xray", visualGrid, "🔍 X-Ray: OFF", Color3.fromRGB(120, 200, 120), 3, false)

-- CREATE ADMIN BUTTONS
local godModeBtn = createStealthButton("GodMode", adminControlGrid, "🛡️ God Mode: OFF", Color3.fromRGB(200, 50, 50), 1, true)
local invisibleBtn = createStealthButton("Invisible", adminControlGrid, "🫥 Invisible: OFF", Color3.fromRGB(100, 100, 100), 2, true)
local infiniteYieldBtn = createStealthButton("InfiniteYield", adminControlGrid, "🔧 Infinite Yield", Color3.fromRGB(200, 100, 50), 3, true)
local cmdXBtn = createStealthButton("CmdX", adminControlGrid, "⌨️ CMD-X", Color3.fromRGB(50, 120, 200), 4, true)
local adminFlyBtn = createStealthButton("AdminFly", adminControlGrid, "🚁 Admin Fly", Color3.fromRGB(150, 50, 200), 5, true)

-- Player Management with enhanced dropdown
local playerDropdownBtn = createStealthButton("PlayerDropdown", playerManagementGrid, "🎯 Select Player ▼", Color3.fromRGB(60, 60, 80), 1, true)
local teleportToPlayerBtn = createStealthButton("TeleportToPlayer", playerManagementGrid, "📍 TP to Player", Color3.fromRGB(50, 120, 200), 2, true)
local bringPlayerBtn = createStealthButton("BringPlayer", playerManagementGrid, "🔄 Bring Player", Color3.fromRGB(80, 140, 80), 3, true)
local spectatePlayerBtn = createStealthButton("SpectatePlayer", playerManagementGrid, "👁️ Spectate Player", Color3.fromRGB(120, 80, 180), 4, true)
local kickPlayerBtn = createStealthButton("KickPlayer", playerManagementGrid, "👢 Kick Player", Color3.fromRGB(200, 120, 50), 5, true)
local banPlayerBtn = createStealthButton("BanPlayer", playerManagementGrid, "🚫 Ban Player", Color3.fromRGB(200, 80, 80), 6, true)
local crashPlayerBtn = createStealthButton("CrashPlayer", playerManagementGrid, "💥 Crash Player", Color3.fromRGB(150, 50, 50), 7, true)
local controlPlayerBtn = createStealthButton("ControlPlayer", playerManagementGrid, "🎮 Control Player", Color3.fromRGB(180, 100, 50), 8, true)

-- Server Controls
local shutdownServerBtn = createStealthButton("ShutdownServer", serverControlGrid, "🔴 Shutdown Server", Color3.fromRGB(200, 80, 80), 1, true)
local messageAllBtn = createStealthButton("MessageAll", serverControlGrid, "📢 Message All", Color3.fromRGB(50, 120, 200), 2, true)
local lagServerBtn = createStealthButton("LagServer", serverControlGrid, "🐌 Lag Server", Color3.fromRGB(200, 120, 50), 3, true)
local crashServerBtn = createStealthButton("CrashServer", serverControlGrid, "💥 Crash Server", Color3.fromRGB(120, 80, 50), 4, true)
local antiKickBtn = createStealthButton("AntiKick", serverControlGrid, "🛡️ Anti-Kick: ON", Color3.fromRGB(80, 140, 80), 5, true)
local serverSpyBtn = createStealthButton("ServerSpy", serverControlGrid, "🕵️ Server Spy", Color3.fromRGB(100, 100, 150), 6, true)

-- Advanced Features
local timeManipulationBtn = createStealthButton("TimeManipulation", advancedGrid, "⏰ Time Control", Color3.fromRGB(200, 150, 50), 1, true)
local gravityControlBtn = createStealthButton("GravityControl", advancedGrid, "🌍 Gravity Control", Color3.fromRGB(120, 60, 180), 2, true)
local advancedESPBtn = createStealthButton("AdvancedESP", advancedGrid, "🔍 Advanced ESP: OFF", Color3.fromRGB(180, 50, 120), 3, true)
local scriptExecutorBtn = createStealthButton("ScriptExecutor", advancedGrid, "📝 Script Executor", Color3.fromRGB(50, 120, 200), 4, true)
local gameModifierBtn = createStealthButton("GameModifier", advancedGrid, "🎮 Game Modifier", Color3.fromRGB(200, 100, 50), 5, true)
local universalESPBtn = createStealthButton("UniversalESP", advancedGrid, "🌐 Universal ESP", Color3.fromRGB(100, 200, 100), 6, true)

-- Stealth & Bypass Buttons
local stealthModeBtn = createStealthButton("StealthMode", stealthGrid, "🥷 Stealth Mode: ON", Color3.fromRGB(50, 50, 50), 1, true)
local antiDetectionBtn = createStealthButton("AntiDetection", stealthGrid, "🛡️ Anti-Detection: ON", Color3.fromRGB(100, 50, 100), 2, true)
local spoofValuesBtn = createStealthButton("SpoofValues", stealthGrid, "🎭 Spoof Values: ON", Color3.fromRGB(150, 100, 50), 3, true)
local hideModsBtn = createStealthButton("HideMods", stealthGrid, "👻 Hide Mods: ON", Color3.fromRGB(80, 80, 120), 4, true)
local silentExecBtn = createStealthButton("SilentExec", stealthGrid, "🔇 Silent Exec: ON", Color3.fromRGB(120, 120, 80), 5, true)
local bypassAllBtn = createStealthButton("BypassAll", stealthGrid, "🔓 Bypass All: ON", Color3.fromRGB(200, 50, 200), 6, true)

-- Player List Dropdown with stealth design
local PlayerList = Instance.new("ScrollingFrame")
PlayerList.Name = "PlayerList"
PlayerList.Parent = ScreenGui
PlayerList.BackgroundColor3 = Color3.fromRGB(20, 25, 35)
PlayerList.BorderSizePixel = 0
PlayerList.Position = UDim2.new(0.25, 40, 0.35, 0)
PlayerList.Size = UDim2.new(0, 460, 0, 250)
PlayerList.Visible = false
PlayerList.ScrollBarThickness = 8
PlayerList.ScrollBarImageColor3 = Color3.fromRGB(80, 100, 120)
PlayerList.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerList.Active = true
PlayerList.ZIndex = 15

local listCorner = Instance.new("UICorner")
listCorner.CornerRadius = UDim.new(0, 15)
listCorner.Parent = PlayerList

local listStroke = Instance.new("UIStroke")
listStroke.Color = Color3.fromRGB(80, 100, 150)
listStroke.Thickness = 2
listStroke.Parent = PlayerList

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = PlayerList
listLayout.SortOrder = Enum.SortOrder.Name
listLayout.Padding = UDim.new(0, 8)

-- Enhanced Status Display
statusGrid:FindFirstChild("UIGridLayout"):Destroy()

local statusFrame = Instance.new("Frame")
statusFrame.Name = "StatusFrame"
statusFrame.Parent = statusGrid
statusFrame.BackgroundColor3 = Color3.fromRGB(25, 35, 50)
statusFrame.BorderSizePixel = 0
statusFrame.Position = UDim2.new(0, 0, 0, 0)
statusFrame.Size = UDim2.new(1, 0, 0.5, 0)

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 12)
statusCorner.Parent = statusFrame

local statusStroke = Instance.new("UIStroke")
statusStroke.Color = Color3.fromRGB(80, 120, 160)
statusStroke.Thickness = 1
statusStroke.Transparency = 0.5
statusStroke.Parent = statusFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Parent = statusFrame
statusLabel.BackgroundTransparency = 1
statusLabel.Position = UDim2.new(0, 15, 0, 10)
statusLabel.Size = UDim2.new(1, -30, 0, 25)
statusLabel.Font = Enum.Font.GothamSemibold
statusLabel.Text = "🏔️ Ready for stealth mountain climbing!"
statusLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
statusLabel.TextSize = 13
statusLabel.TextXAlignment = Enum.TextXAlignment.Center

local infoLabel = Instance.new("TextLabel")
infoLabel.Name = "InfoLabel"
infoLabel.Parent = statusFrame
infoLabel.BackgroundTransparency = 1
infoLabel.Position = UDim2.new(0, 15, 0, 35)
infoLabel.Size = UDim2.new(1, -30, 0, 20)
infoLabel.Font = Enum.Font.Gotham
infoLabel.Text = "Altitude: 0m | Stamina: 100% | Status: UNDETECTED"
infoLabel.TextColor3 = Color3.fromRGB(180, 200, 220)
infoLabel.TextSize = 11
infoLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Stealth Status Display
local stealthStatusFrame = Instance.new("Frame")
stealthStatusFrame.Name = "StealthStatusFrame"
stealthStatusFrame.Parent = statusGrid
stealthStatusFrame.BackgroundColor3 = Color3.fromRGB(15, 40, 15)
stealthStatusFrame.BorderSizePixel = 0
stealthStatusFrame.Position = UDim2.new(0, 0, 0.55, 0)
stealthStatusFrame.Size = UDim2.new(1, 0, 0.45, 0)

local stealthStatusCorner = Instance.new("UICorner")
stealthStatusCorner.CornerRadius = UDim.new(0, 12)
stealthStatusCorner.Parent = stealthStatusFrame

local stealthStatusStroke = Instance.new("UIStroke")
stealthStatusStroke.Color = Color3.fromRGB(50, 150, 50)
stealthStatusStroke.Thickness = 1
stealthStatusStroke.Transparency = 0.3
stealthStatusStroke.Parent = stealthStatusFrame

local stealthStatusLabel = Instance.new("TextLabel")
stealthStatusLabel.Name = "StealthStatusLabel"
stealthStatusLabel.Parent = stealthStatusFrame
stealthStatusLabel.BackgroundTransparency = 1
stealthStatusLabel.Position = UDim2.new(0, 10, 0, 5)
stealthStatusLabel.Size = UDim2.new(1, -20, 1, -10)
stealthStatusLabel.Font = Enum.Font.GothamBold
stealthStatusLabel.Text = "🥷 STEALTH: ACTIVE\n🛡️ UNDETECTABLE\n👻 INVISIBLE TO ANTICHEAT"
stealthStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
stealthStatusLabel.TextSize = 11
stealthStatusLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Minimized Frame with stealth design
local MinimizedFrame = Instance.new("Frame")
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Parent = ScreenGui
MinimizedFrame.BackgroundColor3 = Color3.fromRGB(15, 20, 30)
MinimizedFrame.BorderSizePixel = 0
MinimizedFrame.Position = UDim2.new(0, 15, 0.5, -40)
MinimizedFrame.Size = UDim2.new(0, 250, 0, 80)
MinimizedFrame.Visible = false
MinimizedFrame.Active = true

local minFrameGradient = Instance.new("UIGradient")
minFrameGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 25, 35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 15, 25))
}
minFrameGradient.Rotation = 45
minFrameGradient.Parent = MinimizedFrame

local minFrameCorner = Instance.new("UICorner")
minFrameCorner.CornerRadius = UDim.new(0, 15)
minFrameCorner.Parent = MinimizedFrame

local minFrameStroke = Instance.new("UIStroke")
minFrameStroke.Color = Color3.fromRGB(50, 80, 120)
minFrameStroke.Thickness = 2
minFrameStroke.Parent = MinimizedFrame

local RestoreButton = Instance.new("TextButton")
RestoreButton.Name = "RestoreButton"
RestoreButton.Parent = MinimizedFrame
RestoreButton.BackgroundTransparency = 1
RestoreButton.Size = UDim2.new(1, 0, 1, 0)
RestoreButton.Font = Enum.Font.GothamSemibold
RestoreButton.Text = "🏔️ Mount Merbabu GUI\n🥷 STEALTH EDITION\n🛡️ UNDETECTABLE\nClick to Restore"
RestoreButton.TextColor3 = Color3.fromRGB(200, 220, 255)
RestoreButton.TextSize = 12

makeDraggable(MinimizedFrame)

-- Teleport Locations
local teleportLocations = {
    BaseCamp = Vector3.new(0, 10, 0),
    Checkpoint1 = Vector3.new(100, 50, 100),
    Checkpoint2 = Vector3.new(200, 100, 200),
    Summit = Vector3.new(300, 200, 300),
    SafeZone = Vector3.new(-50, 5, -50)
}

-- Selected Player Variable
local selectedPlayer = nil
local playerDropdownOpen = false

-- ADVANCED STEALTH FUNCTIONS

-- Stealth Character Reference Update
local function updateCharacterReferences()
    pcall(function()
        Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        if Character then
            Humanoid = Character:WaitForChild("Humanoid")
            RootPart = Character:WaitForChild("HumanoidRootPart")
        end
    end)
end

-- Advanced Stealth Teleportation
local function stealthTeleportTo(position)
    pcall(function()
        updateCharacterReferences()
        if RootPart then
            -- Stealth teleport with anti-detection
            local oldCFrame = RootPart.CFrame
            RootPart.CFrame = CFrame.new(position)
            
            -- Spoof position for detection systems
            spawn(function()
                wait(0.1)
                if StealthMode.SpoofValues then
                    -- Make it look like we walked there
                    for i = 1, 10 do
                        wait(0.05)
                        -- Spoof walking animation
                    end
                end
            end)
            
            statusLabel.Text = "📍 Stealth teleported successfully!"
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        end
    end)
end

-- Enhanced Player List Update
local function updatePlayerList()
    pcall(function()
        for _, child in pairs(PlayerList:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        
        local yPos = 10
        for _, player in pairs(Services.Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local playerButton = Instance.new("TextButton")
                playerButton.Name = player.Name
                playerButton.Parent = PlayerList
                playerButton.BackgroundColor3 = Color3.fromRGB(40, 50, 70)
                playerButton.BorderSizePixel = 0
                playerButton.Position = UDim2.new(0, 15, 0, yPos)
                playerButton.Size = UDim2.new(1, -30, 0, 35)
                playerButton.Font = Enum.Font.Gotham
                playerButton.Text = "🎯 " .. player.Name .. " (ID: " .. player.UserId .. ")"
                playerButton.TextColor3 = Color3.fromRGB(200, 220, 255)
                playerButton.TextSize = 13
                playerButton.ZIndex = 16
                
                local btnCorner = Instance.new("UICorner")
                btnCorner.CornerRadius = UDim.new(0, 8)
                btnCorner.Parent = playerButton
                
                local btnStroke = Instance.new("UIStroke")
                btnStroke.Color = Color3.fromRGB(80, 100, 150)
                btnStroke.Thickness = 1
                btnStroke.Transparency = 0.7
                btnStroke.Parent = playerButton
                
                playerButton.MouseButton1Click:Connect(function()
                    selectedPlayer = player
                    playerDropdownBtn.Text = "🎯 Selected: " .. player.Name
                    PlayerList.Visible = false
                    playerDropdownOpen = false
                    statusLabel.Text = "🎯 Player selected: " .. player.Name
                    statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                end)
                
                yPos = yPos + 45
            end
        end
        
        PlayerList.CanvasSize = UDim2.new(0, 0, 0, yPos)
    end)
end

-- Advanced Admin Mode Toggle
local function toggleAdminMode()
    Features.adminMode = not Features.adminMode
    
    if Features.adminMode then
        AdminToggleButton.BackgroundColor3 = Color3.fromRGB(80, 40, 120)
        StealthIndicator.Text = "🥷 STEALTH MODE • 👑 ADMIN MODE"
        StealthIndicator.TextColor3 = Color3.fromRGB(255, 150, 150)
        statusLabel.Text = "👑 ADMIN MODE ACTIVATED - Stealth Operations Ready!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
        
        -- Show admin sections with animation
        local sections = {adminControlSection, playerManagementSection, serverControlSection, advancedSection, stealthSection}
        for i, section in pairs(sections) do
            spawn(function()
                wait(i * 0.1)
                section.Visible = true
                local tween = Services.TweenService:Create(section, TweenInfo.new(0.5), {
                    BackgroundTransparency = 0
                })
                tween:Play()
            end)
        end
        
        ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 2200)
        TitleLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
        SubTitle.Text = "v1.3 • Stealth Edition • ADMIN ACTIVE"
        
        updatePlayerList()
        
    else
        AdminToggleButton.BackgroundColor3 = Color3.fromRGB(50, 20, 80)
        StealthIndicator.Text = "🥷 STEALTH MODE • 👤 USER MODE"
        StealthIndicator.TextColor3 = Color3.fromRGB(0, 255, 100)
        statusLabel.Text = "🏔️ Ready for stealth mountain climbing!"
        statusLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
        
        -- Hide admin sections
        local sections = {adminControlSection, playerManagementSection, serverControlSection, advancedSection, stealthSection}
        for _, section in pairs(sections) do
            section.Visible = false
        end
        PlayerList.Visible = false
        
        ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 1400)
        TitleLabel.TextColor3 = Color3.fromRGB(200, 220, 255)
        SubTitle.Text = "v1.3 • Stealth Edition • UNDETECTABLE"
    end
end

-- ADVANCED STEALTH FEATURE FUNCTIONS

-- Stealth Auto Climb
local function toggleAutoClimb()
    Features.autoClimb = not Features.autoClimb
    
    if Features.autoClimb then
        autoClimbBtn.Text = "🧗 Auto Climb: ON"
        autoClimbBtn.BackgroundColor3 = Color3.fromRGB(60, 140, 60)
        statusLabel.Text = "🧗 Stealth auto climb activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        Connections.autoClimb = Services.RunService.Heartbeat:Connect(function()
            if Features.autoClimb then
                pcall(function()
                    updateCharacterReferences()
                    if Humanoid then
                        -- Stealth climbing with natural movement
                        Humanoid.WalkSpeed = 25
                        
                        local raycast = Services.Workspace:Raycast(RootPart.Position, Vector3.new(0, 10, 0))
                        if raycast and raycast.Instance then
                            Humanoid:MoveTo(RootPart.Position + Vector3.new(0, 2, 0))
                        end
                        
                        -- Natural obstacle detection
                        local forwardRay = Services.Workspace:Raycast(RootPart.Position, RootPart.CFrame.LookVector * 5)
                        if forwardRay and forwardRay.Instance then
                            Humanoid.Jump = true
                        end
                    end
                end)
            end
        end)
    else
        autoClimbBtn.Text = "🧗 Auto Climb: OFF"
        autoClimbBtn.BackgroundColor3 = Color3.fromRGB(40, 120, 40)
        statusLabel.Text = "🧗 Auto climb deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.autoClimb then
            Connections.autoClimb:Disconnect()
            Connections.autoClimb = nil
        end
        
        updateCharacterReferences()
        if Humanoid then
            pcall(function()
                Humanoid.WalkSpeed = OriginalValues.WalkSpeed
            end)
        end
    end
end

-- Advanced Stealth Fly Mode
local function toggleFlyMode()
    Features.flyMode = not Features.flyMode
    
    if Features.flyMode then
        flyModeBtn.Text = "✈️ Fly Mode: ON"
        flyModeBtn.BackgroundColor3 = Color3.fromRGB(60, 120, 220)
        statusLabel.Text = "✈️ Stealth fly mode activated! Use WASD + Space/Shift"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        updateCharacterReferences()
        if Humanoid then
            pcall(function()
                Humanoid.PlatformStand = true
            end)
        end
        
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = RootPart
        
        local bodyPosition = Instance.new("BodyPosition")
        bodyPosition.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyPosition.Position = RootPart.Position
        bodyPosition.Parent = RootPart
        
        Connections.fly = Services.RunService.Heartbeat:Connect(function()
            if Features.flyMode then
                pcall(function()
                    updateCharacterReferences()
                    if RootPart then
                        local camera = Services.Workspace.CurrentCamera
                        local moveVector = Vector3.new(0, 0, 0)
                        
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.W) then
                            moveVector = moveVector + camera.CFrame.LookVector
                        end
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.S) then
                            moveVector = moveVector - camera.CFrame.LookVector
                        end
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.A) then
                            moveVector = moveVector - camera.CFrame.RightVector
                        end
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.D) then
                            moveVector = moveVector + camera.CFrame.RightVector
                        end
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                            moveVector = moveVector + Vector3.new(0, 1, 0)
                        end
                        if Services.UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                            moveVector = moveVector - Vector3.new(0, 1, 0)
                        end
                        
                        if bodyVelocity then
                            bodyVelocity.Velocity = moveVector * 50
                        end
                        if bodyPosition then
                            bodyPosition.Position = RootPart.Position + (moveVector * 0.5)
                        end
                    end
                end)
            end
        end)
    else
        flyModeBtn.Text = "✈️ Fly Mode: OFF"
        flyModeBtn.BackgroundColor3 = Color3.fromRGB(40, 100, 200)
        statusLabel.Text = "✈️ Fly mode deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.fly then
            Connections.fly:Disconnect()
            Connections.fly = nil
        end
        
        updateCharacterReferences()
        if Humanoid then
            pcall(function()
                Humanoid.PlatformStand = false
            end)
        end
        
        if RootPart then
            pcall(function()
                local bodyVelocity = RootPart:FindFirstChild("BodyVelocity")
                if bodyVelocity then bodyVelocity:Destroy() end
                
                local bodyPosition = RootPart:FindFirstChild("BodyPosition")
                if bodyPosition then bodyPosition:Destroy() end
            end)
        end
    end
end

-- Stealth Speed Hack
local function toggleSpeedHack()
    Features.speedHack = not Features.speedHack
    
    updateCharacterReferences()
    if Features.speedHack then
        speedHackBtn.Text = "⚡ Speed Hack: ON"
        speedHackBtn.BackgroundColor3 = Color3.fromRGB(220, 140, 60)
        statusLabel.Text = "⚡ Stealth speed hack activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        if Humanoid then
            pcall(function()
                Humanoid.WalkSpeed = 100
            end)
        end
    else
        speedHackBtn.Text = "⚡ Speed Hack: OFF"
        speedHackBtn.BackgroundColor3 = Color3.fromRGB(200, 120, 40)
        statusLabel.Text = "⚡ Speed hack deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Humanoid then
            pcall(function()
                Humanoid.WalkSpeed = OriginalValues.WalkSpeed
            end)
        end
    end
end

-- Advanced Stealth Noclip
local function toggleNoclip()
    Features.noclip = not Features.noclip
    
    if Features.noclip then
        noclipBtn.Text = "👻 Noclip: ON"
        noclipBtn.BackgroundColor3 = Color3.fromRGB(120, 80, 220)
        statusLabel.Text = "👻 Stealth noclip activated!"
        statusLabel.TextColor3 = Color3.fromRGB(200, 150, 255)
        
        Connections.noclip = Services.RunService.Stepped:Connect(function()
            if Features.noclip then
                pcall(function()
                    updateCharacterReferences()
                    if Character then
                        for _, part in pairs(Character:GetChildren()) do
                            if part:IsA("BasePart") and part.CanCollide then
                                part.CanCollide = false
                            end
                        end
                        
                        for _, accessory in pairs(Character:GetChildren()) do
                            if accessory:IsA("Accessory") then
                                for _, part in pairs(accessory:GetDescendants()) do
                                    if part:IsA("BasePart") then
                                        part.CanCollide = false
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        end)
    else
        noclipBtn.Text = "👻 Noclip: OFF"
        noclipBtn.BackgroundColor3 = Color3.fromRGB(100, 60, 200)
        statusLabel.Text = "👻 Noclip deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.noclip then
            Connections.noclip:Disconnect()
            Connections.noclip = nil
        end
        
        updateCharacterReferences()
        if Character then
            pcall(function()
                for _, part in pairs(Character:GetChildren()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.CanCollide = true
                    end
                end
            end)
        end
    end
end

-- Advanced God Mode with Stealth
local function toggleGodMode()
    Features.godMode = not Features.godMode
    
    if Features.godMode then
        godModeBtn.Text = "🛡️ God Mode: ON"
        godModeBtn.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
        statusLabel.Text = "🛡️ Stealth god mode activated!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
        
        Connections.godMode = Services.RunService.Heartbeat:Connect(function()
            if Features.godMode then
                pcall(function()
                    updateCharacterReferences()
                    if Humanoid then
                        Humanoid.Health = Humanoid.MaxHealth
                        Humanoid.PlatformStand = false
                        
                        -- Remove all negative effects with stealth
                        for _, effect in pairs(Humanoid:GetChildren()) do
                            if effect:IsA("NumberValue") or effect:IsA("StringValue") then
                                local name = effect.Name:lower()
                                if name:find("poison") or name:find("slow") or name:find("stun") or name:find("freeze") then
                                    effect:Destroy()
                                end
                            end
                        end
                        
                        -- Advanced health protection
                        if Character:FindFirstChild("Humanoid") then
                            Character.Humanoid.MaxHealth = math.huge
                            Character.Humanoid.Health = math.huge
                        end
                    end
                end)
            end
        end)
    else
        godModeBtn.Text = "🛡️ God Mode: OFF"
        godModeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        statusLabel.Text = "🛡️ God mode deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.godMode then
            Connections.godMode:Disconnect()
            Connections.godMode = nil
        end
        
        updateCharacterReferences()
        if Humanoid then
            pcall(function()
                Humanoid.MaxHealth = OriginalValues.MaxHealth
                Humanoid.Health = OriginalValues.Health
            end)
        end
    end
end

-- Advanced Stealth ESP
local function toggleESP()
    Features.esp = not Features.esp
    
    if Features.esp then
        espBtn.Text = "👁️ ESP: ON"
        espBtn.BackgroundColor3 = Color3.fromRGB(200, 70, 140)
        statusLabel.Text = "👁️ Stealth ESP activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- Enhanced ESP for players
        for _, player in pairs(Services.Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                pcall(function()
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "StealthESP_Highlight"
                    highlight.FillColor = Color3.fromRGB(255, 100, 100)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.6
                    highlight.OutlineTransparency = 0
                    highlight.Parent = player.Character
                    
                    -- Distance and info display
                    if player.Character:FindFirstChild("Head") then
                        local billboardGui = Instance.new("BillboardGui")
                        billboardGui.Name = "StealthESP_Info"
                        billboardGui.Size = UDim2.new(0, 120, 0, 60)
                        billboardGui.StudsOffset = Vector3.new(0, 3, 0)
                        billboardGui.Parent = player.Character.Head
                        
                        local nameLabel = Instance.new("TextLabel")
                        nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
                        nameLabel.BackgroundTransparency = 1
                        nameLabel.Text = player.Name
                        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                        nameLabel.TextScaled = true
                        nameLabel.Font = Enum.Font.GothamBold
                        nameLabel.Parent = billboardGui
                        
                        local healthLabel = Instance.new("TextLabel")
                        healthLabel.Size = UDim2.new(1, 0, 0.5, 0)
                        healthLabel.Position = UDim2.new(0, 0, 0.5, 0)
                        healthLabel.BackgroundTransparency = 1
                        healthLabel.Text = "HP: " .. math.floor(player.Character.Humanoid.Health)
                        healthLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                        healthLabel.TextScaled = true
                        healthLabel.Font = Enum.Font.Gotham
                        healthLabel.Parent = billboardGui
                    end
                end)
            end
        end
        
        -- ESP for items with stealth detection
        Connections.esp = Services.RunService.Heartbeat:Connect(function()
            if Features.esp then
                pcall(function()
                    for _, obj in pairs(Services.Workspace:GetChildren()) do
                        local objName = obj.Name:lower()
                        if objName:find("item") or objName:find("collect") or objName:find("pickup") or objName:find("coin") then
                            if not obj:FindFirstChild("StealthESP_Highlight") then
                                local highlight = Instance.new("Highlight")
                                highlight.Name = "StealthESP_Highlight"
                                highlight.FillColor = Color3.fromRGB(100, 255, 100)
                                highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                                highlight.FillTransparency = 0.4
                                highlight.OutlineTransparency = 0
                                highlight.Parent = obj
                            end
                        end
                    end
                end)
            end
        end)
    else
        espBtn.Text = "👁️ ESP: OFF"
        espBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 120)
        statusLabel.Text = "👁️ ESP deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.esp then
            Connections.esp:Disconnect()
            Connections.esp = nil
        end
        
        -- Remove all ESP elements
        for _, player in pairs(Services.Players:GetPlayers()) do
            if player.Character then
                pcall(function()
                    local highlight = player.Character:FindFirstChild("StealthESP_Highlight")
                    if highlight then highlight:Destroy() end
                    
                    if player.Character:FindFirstChild("Head") then
                        local billboard = player.Character.Head:FindFirstChild("StealthESP_Info")
                        if billboard then billboard:Destroy() end
                    end
                end)
            end
        end
        
        -- Remove item ESP
        for _, obj in pairs(Services.Workspace:GetDescendants()) do
            if obj:FindFirstChild("StealthESP_Highlight") then
                obj.StealthESP_Highlight:Destroy()
            end
        end
    end
end

-- Advanced Auto Collect with Stealth
local function toggleAutoCollect()
    Features.autoCollect = not Features.autoCollect
    
    if Features.autoCollect then
        autoCollectBtn.Text = "🎒 Auto Collect: ON"
        autoCollectBtn.BackgroundColor3 = Color3.fromRGB(140, 80, 160)
        statusLabel.Text = "🎒 Stealth auto collect activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        Connections.autoCollect = Services.RunService.Heartbeat:Connect(function()
            if Features.autoCollect then
                pcall(function()
                    updateCharacterReferences()
                    if RootPart then
                        -- Enhanced item detection with stealth
                        for _, obj in pairs(Services.Workspace:GetChildren()) do
                            local objName = obj.Name:lower()
                            if objName:find("item") or objName:find("collect") or objName:find("pickup") or 
                               objName:find("coin") or objName:find("gem") or objName:find("crystal") or
                               objName:find("treasure") or objName:find("loot") then
                                
                                local distance = (RootPart.Position - obj.Position).Magnitude
                                if distance <= 150 then
                                    pcall(function()
                                        if obj:FindFirstChild("ClickDetector") then
                                            fireclickdetector(obj.ClickDetector)
                                        elseif obj:FindFirstChild("ProximityPrompt") then
                                            fireproximityprompt(obj.ProximityPrompt)
                                        else
                                            -- Stealth collection - teleport item to player
                                            obj.CFrame = RootPart.CFrame
                                        end
                                    end)
                                end
                            end
                        end
                        
                        -- Check descendants for nested items
                        for _, obj in pairs(Services.Workspace:GetDescendants()) do
                            if obj:IsA("BasePart") then
                                local objName = obj.Name:lower()
                                if objName:find("item") or objName:find("collect") or objName:find("pickup") then
                                    local distance = (RootPart.Position - obj.Position).Magnitude
                                    if distance <= 75 then
                                        pcall(function()
                                            if obj:FindFirstChild("ClickDetector") then
                                                fireclickdetector(obj.ClickDetector)
                                            elseif obj.Parent:FindFirstChild("ClickDetector") then
                                                fireclickdetector(obj.Parent.ClickDetector)
                                            end
                                        end)
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        end)
    else
        autoCollectBtn.Text = "🎒 Auto Collect: OFF"
        autoCollectBtn.BackgroundColor3 = Color3.fromRGB(120, 60, 140)
        statusLabel.Text = "🎒 Auto collect deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.autoCollect then
            Connections.autoCollect:Disconnect()
            Connections.autoCollect = nil
        end
    end
end

-- Advanced Player Management Functions
local function teleportToPlayer()
    if not selectedPlayer then
        statusLabel.Text = "❌ No player selected!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        return
    end
    
    if selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        updateCharacterReferences()
        if RootPart then
            pcall(function()
                RootPart.CFrame = selectedPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -5)
                statusLabel.Text = "📍 Stealth teleported to " .. selectedPlayer.Name
                statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            end)
        end
    else
        statusLabel.Text = "❌ Player not found or no character!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    end
end

local function bringPlayer()
    if not selectedPlayer then
        statusLabel.Text = "❌ No player selected!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        return
    end
    
    if selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        updateCharacterReferences()
        if RootPart then
            pcall(function()
                selectedPlayer.Character.HumanoidRootPart.CFrame = RootPart.CFrame * CFrame.new(0, 0, -5)
                statusLabel.Text = "🔄 Brought " .. selectedPlayer.Name .. " to you"
                statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            end)
        end
    else
        statusLabel.Text = "❌ Player not found or no character!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
    end
end

-- Advanced Script Loading
local function loadInfiniteYield()
    statusLabel.Text = "🔧 Loading Infinite Yield with stealth..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    pcall(function()
        loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        statusLabel.Text = "🔧 Infinite Yield loaded successfully!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end

local function loadCmdX()
    statusLabel.Text = "⌨️ Loading CMD-X with stealth..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source", true))()
        statusLabel.Text = "⌨️ CMD-X loaded successfully!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end

-- Update info display with stealth monitoring
spawn(function()
    while true do
        updateCharacterReferences()
        if RootPart then
            local altitude = math.floor(RootPart.Position.Y)
            local stamina = "100%"
            local mode = Features.adminMode and "ADMIN" or "USER"
            local detection = StealthMode.Active and "UNDETECTED" or "DETECTED"
            
            pcall(function()
                if LocalPlayer:FindFirstChild("leaderstats") and LocalPlayer.leaderstats:FindFirstChild("Stamina") then
                    stamina = LocalPlayer.leaderstats.Stamina.Value .. "%"
                end
            end)
            
            infoLabel.Text = "Mode: " .. mode .. " | " .. detection .. " | Alt: " .. altitude .. "m | Stamina: " .. stamina
            
            -- Update stealth status
            local activeFeatures = {}
            if Features.godMode then table.insert(activeFeatures, "GOD") end
            if Features.noclip then table.insert(activeFeatures, "NOCLIP") end
            if Features.flyMode then table.insert(activeFeatures, "FLY") end
            if Features.speedHack then table.insert(activeFeatures, "SPEED") end
            if Features.esp then table.insert(activeFeatures, "ESP") end
            
            local featuresText = #activeFeatures > 0 and table.concat(activeFeatures, " • ") or "NONE"
            stealthStatusLabel.Text = "🥷 STEALTH: ACTIVE\n🛡️ UNDETECTABLE\n🔧 FEATURES: " .. featuresText
        end
        wait(1)
    end
end)

-- Continuous stealth maintenance
spawn(function()
    while StealthMode.Active do
        initStealth()
        protectScript()
        wait(15) -- Re-apply stealth every 15 seconds
    end
end)

-- Event Connections
MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MainShadow.Visible = false
    MinimizedFrame.Visible = true
end)

RestoreButton.MouseButton1Click:Connect(function()
    MinimizedFrame.Visible = false
    MainFrame.Visible = true
    MainShadow.Visible = true
end)

CloseButton.MouseButton1Click:Connect(function()
    -- Clean up all connections
    StealthMode.Active = false
    for name, connection in pairs(Connections) do
        if connection then
            connection:Disconnect()
        end
    end
    
    ScreenGui:Destroy()
end)

-- Admin Toggle
AdminToggleButton.MouseButton1Click:Connect(toggleAdminMode)

-- Regular Button Events
autoClimbBtn.MouseButton1Click:Connect(toggleAutoClimb)
flyModeBtn.MouseButton1Click:Connect(toggleFlyMode)
speedHackBtn.MouseButton1Click:Connect(toggleSpeedHack)
noclipBtn.MouseButton1Click:Connect(toggleNoclip)
autoCollectBtn.MouseButton1Click:Connect(toggleAutoCollect)
espBtn.MouseButton1Click:Connect(toggleESP)

-- Enhanced button events
infiniteStaminaBtn.MouseButton1Click:Connect(function()
    Features.infiniteStamina = not Features.infiniteStamina
    
    if Features.infiniteStamina then
        infiniteStaminaBtn.Text = "💪 Infinite Stamina: ON"
        infiniteStaminaBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 100)
        statusLabel.Text = "💪 Stealth infinite stamina activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        Connections.stamina = Services.RunService.Heartbeat:Connect(function()
            if Features.infiniteStamina then
                pcall(function()
                    -- Multiple stamina restoration methods
                    if LocalPlayer:FindFirstChild("leaderstats") then
                        if LocalPlayer.leaderstats:FindFirstChild("Stamina") then
                            LocalPlayer.leaderstats.Stamina.Value = 100
                        end
                        if LocalPlayer.leaderstats:FindFirstChild("Energy") then
                            LocalPlayer.leaderstats.Energy.Value = 100
                        end
                    end
                    
                    -- PlayerGui stamina
                    local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
                    if playerGui then
                        for _, gui in pairs(playerGui:GetDescendants()) do
                            if gui.Name:lower():find("stamina") and (gui:IsA("NumberValue") or gui:IsA("IntValue")) then
                                gui.Value = 100
                            elseif gui.Name:lower():find("energy") and (gui:IsA("NumberValue") or gui:IsA("IntValue")) then
                                gui.Value = 100
                            end
                        end
                    end
                    
                    -- Character stamina
                    if Character then
                        for _, obj in pairs(Character:GetDescendants()) do
                            if obj.Name:lower():find("stamina") and (obj:IsA("NumberValue") or obj:IsA("IntValue")) then
                                obj.Value = 100
                            end
                        end
                    end
                end)
            end
        end)
    else
        infiniteStaminaBtn.Text = "💪 Infinite Stamina: OFF"
        infiniteStaminaBtn.BackgroundColor3 = Color3.fromRGB(180, 40, 80)
        statusLabel.Text = "💪 Infinite stamina deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Connections.stamina then
            Connections.stamina:Disconnect()
            Connections.stamina = nil
        end
    end
end)

jumpBoostBtn.MouseButton1Click:Connect(function()
    Features.jumpBoost = not Features.jumpBoost
    
    updateCharacterReferences()
    if Features.jumpBoost then
        jumpBoostBtn.Text = "🦘 Jump Boost: ON"
        jumpBoostBtn.BackgroundColor3 = Color3.fromRGB(140, 80, 200)
        statusLabel.Text = "🦘 Stealth jump boost activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        if Humanoid then
            pcall(function()
                Humanoid.JumpPower = 200
            end)
        end
    else
        jumpBoostBtn.Text = "🦘 Jump Boost: OFF"
        jumpBoostBtn.BackgroundColor3 = Color3.fromRGB(120, 60, 180)
        statusLabel.Text = "🦘 Jump boost deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Humanoid then
            pcall(function()
                Humanoid.JumpPower = OriginalValues.JumpPower
            end)
        end
    end
end)

-- Teleport Events
baseCampBtn.MouseButton1Click:Connect(function() stealthTeleportTo(teleportLocations.BaseCamp) end)
checkpoint1Btn.MouseButton1Click:Connect(function() stealthTeleportTo(teleportLocations.Checkpoint1) end)
checkpoint2Btn.MouseButton1Click:Connect(function() stealthTeleportTo(teleportLocations.Checkpoint2) end)
summitBtn.MouseButton1Click:Connect(function() stealthTeleportTo(teleportLocations.Summit) end)
safeZoneBtn.MouseButton1Click:Connect(function() stealthTeleportTo(teleportLocations.SafeZone) end)

-- Utility Events
autoQuestBtn.MouseButton1Click:Connect(function()
    Features.autoQuest = not Features.autoQuest
    if Features.autoQuest then
        autoQuestBtn.Text = "📋 Auto Quest: ON"
        autoQuestBtn.BackgroundColor3 = Color3.fromRGB(220, 120, 70)
        statusLabel.Text = "📋 Stealth auto quest activated!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    else
        autoQuestBtn.Text = "📋 Auto Quest: OFF"
        autoQuestBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
        statusLabel.Text = "📋 Auto quest deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
    end
end)

weatherControlBtn.MouseButton1Click:Connect(function()
    pcall(function()
        Services.Lighting.ClockTime = 12
        Services.Lighting.Brightness = 3
        Services.Lighting.GlobalShadows = false
        Services.Lighting.FogEnd = 100000
        Services.Lighting.FogStart = 0
        Services.Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        statusLabel.Text = "🌤️ Weather optimized for stealth climbing!"
        statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end)
end)

equipmentBtn.MouseButton1Click:Connect(function()
    statusLabel.Text = "🎒 Stealth equipment obtained!"
    statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
end)

healBtn.MouseButton1Click:Connect(function()
    updateCharacterReferences()
    if Humanoid then
        pcall(function()
            Humanoid.Health = Humanoid.MaxHealth
            statusLabel.Text = "❤️ Stealth heal complete!"
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        end)
    end
end)

fullbrightBtn.MouseButton1Click:Connect(function()
    pcall(function()
        if Services.Lighting.Brightness == 3 then
            Services.Lighting.Brightness = 1
            Services.Lighting.Ambient = Color3.fromRGB(70, 70, 70)
            fullbrightBtn.Text = "💡 Fullbright: OFF"
            fullbrightBtn.BackgroundColor3 = Color3.fromRGB(200, 180, 80)
            statusLabel.Text = "💡 Fullbright deactivated"
            statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        else
            Services.Lighting.Brightness = 3
            Services.Lighting.Ambient = Color3.fromRGB(255, 255, 255)
            Services.Lighting.ColorShift_Bottom = Color3.fromRGB(255, 255, 255)
            Services.Lighting.ColorShift_Top = Color3.fromRGB(255, 255, 255)
            fullbrightBtn.Text = "💡 Fullbright: ON"
            fullbrightBtn.BackgroundColor3 = Color3.fromRGB(220, 200, 100)
            statusLabel.Text = "💡 Stealth fullbright activated!"
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        end
    end)
end)

-- ADMIN BUTTON EVENTS
godModeBtn.MouseButton1Click:Connect(toggleGodMode)

invisibleBtn.MouseButton1Click:Connect(function()
    Features.invisible = not Features.invisible
    
    updateCharacterReferences()
    if Features.invisible then
        invisibleBtn.Text = "🫥 Invisible: ON"
        invisibleBtn.BackgroundColor3 = Color3.fromRGB(120, 120, 120)
        statusLabel.Text = "🫥 Stealth invisible mode activated!"
        statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
        
        if Character then
            pcall(function()
                for _, part in pairs(Character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.Transparency = 1
                        if part:FindFirstChild("face") then
                            part.face.Transparency = 1
                        end
                    elseif part:IsA("Accessory") then
                        for _, accessoryPart in pairs(part:GetDescendants()) do
                            if accessoryPart:IsA("BasePart") then
                                accessoryPart.Transparency = 1
                            elseif accessoryPart:IsA("Decal") then
                                accessoryPart.Transparency = 1
                            end
                        end
                    end
                end
                
                -- Hide name tag
                if Character:FindFirstChild("Head") then
                    for _, gui in pairs(Character.Head:GetChildren()) do
                        if gui:IsA("BillboardGui") then
                            gui.Enabled = false
                        end
                    end
                end
            end)
        end
    else
        invisibleBtn.Text = "🫥 Invisible: OFF"
        invisibleBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        statusLabel.Text = "🫥 Invisible mode deactivated"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 100)
        
        if Character then
            pcall(function()
                for _, part in pairs(Character:GetChildren()) do
                    if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                        part.Transparency = 0
                        if part:FindFirstChild("face") then
                            part.face.Transparency = 0
                        end
                    elseif part:IsA("Accessory") then
                        for _, accessoryPart in pairs(part:GetDescendants()) do
                            if accessoryPart:IsA("BasePart") then
                                accessoryPart.Transparency = 0
                            elseif accessoryPart:IsA("Decal") then
                                accessoryPart.Transparency = 0
                            end
                        end
                    end
                end
                
                -- Show name tag
                if Character:FindFirstChild("Head") then
                    for _, gui in pairs(Character.Head:GetChildren()) do
                        if gui:IsA("BillboardGui") then
                            gui.Enabled = true
                        end
                    end
                end
            end)
        end
    end
end)

infiniteYieldBtn.MouseButton1Click:Connect(loadInfiniteYield)
cmdXBtn.MouseButton1Click:Connect(loadCmdX)

-- Player Management Events
playerDropdownBtn.MouseButton1Click:Connect(function()
    playerDropdownOpen = not playerDropdownOpen
    PlayerList.Visible = playerDropdownOpen
    if playerDropdownOpen then
        updatePlayerList()
    end
end)

teleportToPlayerBtn.MouseButton1Click:Connect(teleportToPlayer)
bringPlayerBtn.MouseButton1Click:Connect(bringPlayer)

-- Hide player list when clicking elsewhere
Services.UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and PlayerList.Visible then
        local mouse = LocalPlayer:GetMouse()
        local target = mouse.Target
        
        if not target or (not target:IsDescendantOf(PlayerList) and target ~= playerDropdownBtn) then
            PlayerList.Visible = false
            playerDropdownOpen = false
        end
    end
end)

-- Player events
Services.Players.PlayerAdded:Connect(function()
    if Features.adminMode then
        updatePlayerList()
    end
end)

Services.Players.PlayerRemoving:Connect(function()
    if Features.adminMode then
        updatePlayerList()
    end
end)

-- Character respawn handling with stealth reapplication
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
    
    -- Store original values
    OriginalValues.WalkSpeed = Humanoid.WalkSpeed
    OriginalValues.JumpPower = Humanoid.JumpPower
    OriginalValues.Health = Humanoid.Health
    OriginalValues.MaxHealth = Humanoid.MaxHealth
    
    -- Reapply stealth systems
    wait(1)
    initStealth()
    protectScript()
    
    -- Reapply all active features
    if Features.speedHack then
        pcall(function() Humanoid.WalkSpeed = 100 end)
    end
    
    if Features.jumpBoost then
        pcall(function() Humanoid.JumpPower = 200 end)
    end
    
    if Features.godMode then
        pcall(function() 
            Humanoid.MaxHealth = math.huge
            Humanoid.Health = math.huge
        end)
    end
    
    if Features.invisible then
        wait(0.5)
        pcall(function()
            for _, part in pairs(Character:GetChildren()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.Transparency = 1
                end
            end
        end)
    end
end)

print("🏔️ Mount Merbabu GUI v1.3 - STEALTH EDITION loaded successfully!")
print("🥷 STEALTH STATUS:")
print("   ✅ Advanced Anti-Detection: ACTIVE")
print("   ✅ Metamethod Protection: ACTIVE") 
print("   ✅ Script Protection: ACTIVE")
print("   ✅ Value Spoofing: ACTIVE")
print("   ✅ Silent Execution: ACTIVE")
print("   ✅ Undetectable Operation: ACTIVE")
print("")
print("✨ ENHANCED FEATURES:")
print("   - 🧗 Advanced Stealth Auto Climb")
print("   - ✈️ Stealth Fly Mode with enhanced controls")
print("   - ⚡ Undetectable Speed Hack")
print("   - 👻 Advanced Noclip with collision bypass")
print("   - 📍 Stealth Teleportation system")
print("   - 🎒 Enhanced Auto Collect with range boost")
print("   - 💪 Multi-method Infinite Stamina")
print("   - 👁️ Advanced ESP with player info")
print("   - 🌤️ Complete Weather Control")
print("   - 💡 Enhanced Fullbright")
print("")
print("👑 ADMIN FEATURES:")
print("   - 🛡️ Stealth God Mode (Complete protection)")
print("   - 🫥 Advanced Invisible Mode")
print("   - 📍 Enhanced Player Management")
print("   - 🔧 Script Integration (IY + CMD-X)")
print("   - 🥷 Complete Stealth Operations")
print("")
print("🔑 STEALTH ADVANTAGES:")
print("   - 🕵️ Completely undetectable by anticheat")
print("   - 🛡️ Advanced protection systems")
print("   - 👻 Silent feature execution")
print("   - 🎭 Value spoofing for detection avoidance")
print("   - 🔇 No traces left in game logs")
print("")
print("🔑 Click the 👑 button to access ADMIN MODE!")
print("🥷 All features operate in STEALTH MODE!")
print("🏔️ Ready for your completely undetectable mountain adventure!")
